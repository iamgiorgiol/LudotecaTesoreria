<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Gestione Spese - Inserimento</title>
<link rel="stylesheet" href="style.css">
<script src="offline.js" defer></script>
</head>
<body>

<div class="nav">
    <a href="index.html">Inserimento</a>
    <a href="report.html">Report</a>
    <a href="grafici.html">Grafici</a>
</div>

<div class="offline-banner" id="offlineBanner">Sei offline → i dati saranno salvati localmente</div>

<div class="container">
    <h2>Inserimento Movimento</h2>

    <label>Tipo</label>
    <select id="tipo">
        <option>entrata</option>
        <option>uscita</option>
    </select>

    <label>Data</label>
    <input type="date" id="data">

    <label>Descrizione</label>
    <input type="text" id="descrizione">

    <label>Valore (€)</label>
    <input type="number" id="valore" step="0.01">

    <label>Categoria</label>
    <input type="text" id="categoria">

    <button onclick="inviaDati()">Salva</button>

    <div id="success" class="alert success">Dati salvati ✔️</div>
    <div id="error" class="alert error">Errore nel salvataggio ❗</div>
</div>

<script>
// Google Form endpoint
const FORM_URL = "https://docs.google.com/forms/u/0/d/1i-9fk3zeqZDa_PRIHVkkb-3n52eDoCXpzxRrIe_dK9A/formResponse";
const ENTRY_TIPO = "entry.1530881892";
const ENTRY_DATA = "entry.336709630";
const ENTRY_DESC = "entry.1542207063";
const ENTRY_VALORE = "entry.1460849949";
const ENTRY_CATEGORIA = "entry.53596318";

function inviaDati() {

    const movimento = {
        tipo: document.getElementById("tipo").value,
        data: document.getElementById("data").value,
        descrizione: document.getElementById("descrizione").value,
        valore: document.getElementById("valore").value,
        categoria: document.getElementById("categoria").value
    };

    if (!navigator.onLine) {
        salvaOffline(movimento);
        return;
    }

    const fd = new FormData();
    fd.append(ENTRY_TIPO, movimento.tipo);
    fd.append(ENTRY_DATA, movimento.data);
    fd.append(ENTRY_DESC, movimento.descrizione);
    fd.append(ENTRY_VALORE, movimento.valore);
    fd.append(ENTRY_CATEGORIA, movimento.categoria);

    fetch(FORM_URL, { method: "POST", mode: "no-cors", body: fd })
    .then(() => {
        document.getElementById("success").style.display = "block";
        setTimeout(() => location.reload(), 1000);
    })
    .catch(() => {
        salvaOffline(movimento);
    });
}
</script>

</body>
</html>

